# Default values for polytomic.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

image:
  # -- Image repository
  repository: 568237466542.dkr.ecr.us-west-2.amazonaws.com/polytomic-onprem
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Image tag. Defaults to Chart.appVersion if not specified.
  # For production, always specify a concrete version (e.g., "rel2021.11.04")
  # See https://docs.polytomic.com/changelog for available versions
  tag: ""

# -- Reference to one or more secrets to be used when pulling images
# Used both for chart-managed pods and passed to Polytomic for dynamically created job pods
# Example: imagePullSecrets:
#   - name: polytomic-ecr
imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# -- Global health probe configuration
healthProbes:
  readinessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: true
  # -- Name of the ingress class to route through this controller
  className: nginx
  annotations:
    {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: localhost
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

polytomic:
  # valid values are debug, info, warn, error; the default is info
  log_level: info

  env: ""

  deployment:
    # -- A unique identifier for your on premises deploy, provided by Polytomic.
    name: ""
    # -- The license key for your deployment, provided by Polytomic.
    key: ""
    # -- The global api key for your deployment, user provided.
    api_key: ""

  # List of features to enable for all organizations by default
  default_org_features: []

  field_change_tracking: true
  query_workers: 10
  sync_retry_errors: true
  sync_workers: 10
  # -- Per-role executor configuration.
  # Fields map to the {prefix}_* environment variables read by the application.
  # Prefixes: task → TASK_EXECUTOR, bulk → BULK_EXECUTOR, ingest → INGEST_EXECUTOR,
  #           proxy → PROXY_EXECUTOR, scheduler → SCHEDULER_ROLE.
  #
  # The task role is the base: any field left at 0/"" in bulk/ingest/proxy/scheduler
  # will inherit the corresponding task value at runtime (setDefaultRoleConfig).
  # Only override the other roles when you need role-specific values.
  roles:
    task:
      # -- Seconds to sleep after task completion before cleaning up
      cleanup_delay_seconds: 10
      cpu: 0
      memory_reservation: 0
      memory_maximum: 0
      memory_mega: 0
      database_pool_size: 0
      redis_pool_size: 0
      tags: ""
    bulk:
      cleanup_delay_seconds: 0
      cpu: 0
      memory_reservation: 0
      memory_maximum: 0
      memory_mega: 0
      database_pool_size: 0
      redis_pool_size: 0
      tags: ""
    ingest:
      cleanup_delay_seconds: 0
      cpu: 0
      memory_reservation: 0
      memory_maximum: 0
      memory_mega: 0
      database_pool_size: 0
      redis_pool_size: 0
      tags: ""
    proxy:
      cleanup_delay_seconds: 0
      cpu: 0
      memory_reservation: 0
      memory_maximum: 0
      memory_mega: 0
      database_pool_size: 0
      redis_pool_size: 0
      tags: ""
    scheduler:
      cleanup_delay_seconds: 0
      cpu: 0
      memory_reservation: 0
      memory_maximum: 0
      memory_mega: 0
      database_pool_size: 0
      redis_pool_size: 0
      tags: ""
  tx_buffer_size: 1000

  auth:
    #  -- The email address to use when starting for the first time;
    # this user will be able to add additional users and configure Polytomic.
    root_user: user@example.com

    # -- Base URL for accessing Polytomic; for example, https://polytomic.mycompany.com.
    # This will be used when redirecting back from Google and
    # other integrations after authenticating with OAuth.
    url: https://polytomic.mycompany.com

    # -- Google OAuth Client ID, obtained by creating a OAuth 2.0 Client ID
    google_client_id: ""
    # -- Google OAuth Client Secret, obtained by creating a OAuth 2.0 Client ID
    google_client_secret: ""

    # -- Single player mode
    # If true, no authentication will be required
    single_player: true

    # list of allowed authentication methods
    methods: []

    workos_api_key: ""
    workos_client_id: ""

  # The bucket stores log files containing records involved in a sync execution.
  # Record logging is enabled from the Settings page within the app ({POLYTOMIC_URL}/user).
  # Credentials for AWS are pulled through the AWS-SDK's credential chain and the user/role must have permissions for the bucket.
  # We recommend setting a bucket lifecycle rule to automatically expire objects.
  s3:
    operational_bucket: "s3://operations"

    # -- Access key ID
    access_key_id: ""
    # -- Secret access key
    secret_access_key: ""
    # -- S3 region e.g. us-east-1
    region: us-east-1

  # Shared volume configuration for worker and sync pods
  # This volume is used for caching and temporary data shared between pods
  sharedVolume:
    # -- Enable shared volume (if false, uses emptyDir)
    enabled: true
    # -- Provisioning mode: "dynamic" (StorageClass), "static" (pre-existing PV), or "emptyDir"
    mode: dynamic
    # -- Volume size
    size: 20Gi
    # -- Mount path in containers
    mountPath: /var/polytomic
    # -- Access modes
    accessModes:
      - ReadWriteMany
    # -- Volume name for PV/PVC
    volumeName: polytomic-shared
    # -- Optional subPath within the volume
    subPath: ""

    # Static provisioning configuration (for pre-existing volumes like EFS)
    # Only used when mode=static
    static:
      # -- CSI driver (e.g., efs.csi.aws.com, nfs.csi.k8s.io)
      driver: efs.csi.aws.com
      # -- Volume handle (e.g., EFS filesystem ID: fs-12345678)
      volumeHandle: ""
      # -- Optional volume attributes for CSI driver
      volumeAttributes: {}
        # Example for EFS:
        # path: /
        # Example for other drivers:
        # server: nfs-server.example.com
        # share: /exports/polytomic

    # Dynamic provisioning configuration (StorageClass-based)
    # Only used when mode=dynamic
    dynamic:
      # -- Storage class name (empty = cluster default)
      storageClassName: ""

  internal_execution_logs: false

  # Integrations
  airtable_client_secret: ""
  asana_client_id: ""
  asana_client_secret: ""
  bingads_client_id: ""
  bingads_client_secret: ""
  bingads_developer_token: ""
  ccloud_api_key: ""
  ccloud_api_secret: ""
  fbaudience_client_id: ""
  fbaudience_client_secret: ""
  fb_login_configuration_id: ""
  front_client_id: ""
  front_client_secret: ""
  github_client_id: ""
  github_client_secret: ""
  github_deploy_key: ""
  googleads_client_id: ""
  googleads_client_secret: ""
  googleads_developer_token: ""
  googlesearchconsole_client_id: ""
  googlesearchconsole_client_secret: ""
  googleworkspace_client_id: ""
  googleworkspace_client_secret: ""
  gsheets_api_key: ""
  gsheets_app_id: ""
  gsheets_client_id: ""
  gsheets_client_secret: ""
  hubspot_client_id: ""
  hubspot_client_secret: ""
  intercom_client_id: ""
  intercom_client_secret: ""
  linkedinads_client_id: ""
  linkedinads_client_secret: ""
  outreach_client_id: ""
  outreach_client_secret: ""
  pardot_client_id: ""
  pardot_client_secret: ""
  salesforce_client_id: ""
  salesforce_client_secret: ""
  shipbob_client_id: ""
  shipbob_client_secret: ""
  shopify_client_id: ""
  shopify_client_secret: ""
  smartsheet_client_id: ""
  smartsheet_client_secret: ""
  stripe_secret_key: ""
  zendesk_client_id: ""
  zendesk_client_secret: ""


  # -- Telemetry
  metrics: false
  tracing: false

#############################################################################################
# DATABASE CONFIGURATION
# Choose ONE option per service:
#   1. Embedded: Set enabled=true (default, for testing/development)
#   2. External: Set enabled=false and configure external* section

# PostgreSQL Database
# Option 1: Embedded PostgreSQL (Bitnami subchart)
postgresql:
  enabled: true  # Set to false to use external database
  auth:
    username: polytomic
    password: polytomic
    database: polytomic
  primary:
    persistence:
      enabled: true
      size: 8Gi
  # For production embedded PostgreSQL, configure proper resources, backups, etc.
  # See: https://artifacthub.io/packages/helm/bitnami/postgresql

# Option 2: External PostgreSQL (RDS, CloudSQL, self-hosted, etc.)
# Only used when postgresql.enabled=false
externalPostgresql:
  # -- External PostgreSQL host (required if postgresql.enabled=false)
  host: ""
  # -- External PostgreSQL port
  port: 5432
  # -- Database username
  username: "polytomic"
  # -- Database password (consider using existing secret)
  password: ""
  # -- Database name
  database: "polytomic"
  # -- Enable SSL/TLS
  ssl: false
  # -- SSL mode (disable, require, verify-ca, verify-full)
  sslMode: "disable"
  # -- Connection pool size
  poolSize: "15"
  # -- Idle timeout
  idleTimeout: "5s"
  # -- Auto-run database migrations on startup
  autoMigrate: true
  # -- Use existing secret for password (optional)
  # If set, password field above is ignored
  existingSecret:
    name: ""
    key: "postgresql-password"

# Redis Cache
# Option 1: Embedded Redis (Bitnami subchart)
redis:
  enabled: true  # Set to false to use external Redis
  auth:
    password: polytomic
    enabled: true
  architecture: standalone
  master:
    persistence:
      enabled: true
      size: 8Gi
  # For production embedded Redis, configure proper resources, replicas, etc.
  # See: https://artifacthub.io/packages/helm/bitnami/redis

# Option 2: External Redis (ElastiCache, MemoryStore, self-hosted, etc.)
# Only used when redis.enabled=false
externalRedis:
  # -- External Redis host (required if redis.enabled=false)
  host: ""
  # -- External Redis port
  port: 6379
  # -- Redis password (consider using existing secret)
  password: ""
  # -- Enable SSL/TLS
  ssl: false
  # -- Connection pool size (0 = unlimited)
  poolSize: 0
  # -- Use existing secret for password (optional)
  # If set, password field above is ignored
  existingSecret:
    name: ""
    key: "redis-password"

minio:
  enabled: false
  rootUser: polytomic
  rootPassword: polytomic
  persistence:
    size: 50Mi
  mode: standalone

nfs-server-provisioner:
  enabled: true
  image:
    repository: registry.k8s.io/sig-storage/nfs-provisioner
    tag: v4.0.8

  persistence:
    enabled: true

  storageClass:
    create: true
    ## Set a provisioner name. If unset, a name will be generated.
    # provisionerName:

    ## Set StorageClass as the default StorageClass
    ## Ignored if storageClass.create is false
    defaultClass: false

    ## Set a StorageClass name
    ## Ignored if storageClass.create is false
    name: nfs

    # set to null to prevent expansion
    allowVolumeExpansion: true
    ## StorageClass parameters
    parameters: {}

#############################################################################################

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

secret:
  # The name of the secret to use instead of generating one
  name: ""

# Production hardening features (disabled by default)
networkPolicy:
  enabled: false
  # Ingress controller namespace selector
  ingressNamespaceSelector:
    name: ingress-nginx
  # PostgreSQL access configuration
  postgresql:
    # For in-cluster PostgreSQL (when postgresql.enabled=true)
    podSelector:
      app.kubernetes.io/name: postgresql
    namespaceSelector:
      kubernetes.io/metadata.name: default
    # For external PostgreSQL (RDS, etc), uncomment and comment out podSelector above:
    # ipBlock: "10.0.0.0/16"
  # Redis access configuration
  redis:
    # For in-cluster Redis (when redis.enabled=true)
    podSelector:
      app.kubernetes.io/name: redis
    namespaceSelector:
      kubernetes.io/metadata.name: default
    # For external Redis (ElastiCache, etc), uncomment and comment out podSelector above:
    # ipBlock: "10.0.0.0/16"
  # Allow HTTPS egress for external integrations
  allowExternalHttps: true
  # Optional: Restrict to specific CIDR ranges (empty = 0.0.0.0/0)
  externalHttpsCidrs: []

# PodDisruptionBudget - ensures minimum availability during disruptions
podDisruptionBudget:
  enabled: false
  minAvailable: 1
  # maxUnavailable: 1  # Use either minAvailable OR maxUnavailable, not both

worker:
  replicaCount: 2
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  autoscaling:
    enabled: false  # Can be enabled if needed
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 2000
  securityContext:
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: false
    runAsUser: 0
  sidecarContainers: []


web:
  replicaCount: 2
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 2000
  securityContext:
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: false
    runAsUser: 0
  sidecarContainers:
  # - image: busybox
  #   name: sidecar-example
  #   args:
  #    - /bin/sh
  #    - -c
  #    - >
  #     while true; do
  #       echo "$(date) INFO hello";
  #       sleep 1;
  #     done
sync:
  replicaCount: 2
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 2000
  securityContext:
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: false
    runAsUser: 0
  sidecarContainers: []

schemacache:
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 2000
  securityContext:
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: false
    runAsUser: 0
  sidecarContainers: []

scheduler:
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 2000
  securityContext:
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: false
    runAsUser: 0
  sidecarContainers: []

jobworker:
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 2000
  securityContext:
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: false
    runAsUser: 0
  sidecarContainers: []

healthcheck:
  resources:
    limits:
      cpu: 100m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 128Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 2000
  securityContext:
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: false
    runAsUser: 0
  sidecarContainers: []

dev:
  enabled: false  # Development deployment disabled by default
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 256Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}
  podSecurityContext:
    fsGroup: 2000
  securityContext:
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: false
    runAsUser: 0

development: false
